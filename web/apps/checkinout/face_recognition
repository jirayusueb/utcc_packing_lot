import face_recognition
import cv2
import psycopg2
import numpy as np

username = 'postgres'
password = 'postgres'
database = 'db'
host = 'localhost'
media = "/Users/Snacky/Downloads/utcc_packing_lot-master-2/media/"

# Connect to the database
con = psycopg2.connect(dbname=database, user=username,
                       password=password, host=host)
cur = con.cursor()
cur.execute("select family_name,image from user_profile_userprofile")
rows = cur.fetchall()

# Train image
known_face_names = []
known_face_encodings = []

for r in rows:
    known_face_encodings.append(
        face_recognition.face_encodings(face_recognition.load_image_file(media + r[1]), model="cnn")[0])
    known_face_names.append(r[0])

# Test image
unknown_image = face_recognition.load_image_file('')
face_locations = face_recognition.face_locations(unknown_image)
face_encodings = face_recognition.face_encodings(unknown_image, face_locations)

for (top, right, bottom, left), face_encoding in zip(face_locations, face_encodings):
    matches = face_recognition.compare_faces(known_face_encodings, face_encoding)
    name = "Unknown"
    face_distances = face_recognition.face_distance(known_face_encodings, face_encoding)
    best_match_index = np.argmin(face_distances)
    if matches[best_match_index]:
        name = known_face_names[best_match_index]
        print(name)
